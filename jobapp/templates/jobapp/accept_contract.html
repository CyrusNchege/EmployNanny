{% extends 'jobapp/base.html' %}

{% block content %}
<style>
p {
  color: black;
}

.signature-pad {
  border: 2px dashed #ddd;
  background-color: #f8f8f8;
  padding: 10px;
  width: 100%;
  max-width: 500px;
  margin-bottom: 20px;
  height: 150px; /* Increase the height to allow space for the signature */
}

.signature-pad canvas {
  width: 100% !important;
  height: 100%;
  border: 1px solid #ccc;
}
.form-container {
  margin-top: -70px;
  margin-bottom: 30px;
}
</style>
<div class="container status-height">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h1 class="text-center mb-4">Contract Details</h1>
      {% if messages %}
      <div class="alert alert-success">
        {% for message in messages %} {{ message }} {% endfor %}
      </div>
      {% endif %}
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Job</h5>
          <p class="card-text">{{ contract.job }}</p>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <h5 class="card-title">Nanny</h5>
            <p class="card-text">{{ contract.nanny }}</p>
          </li>
          <li class="list-group-item">
            <h5 class="card-title">Employer</h5>
            <p class="card-text">{{ contract.employer }}</p>
          </li>
          <li class="list-group-item">
            <h5 class="card-title">Start Date</h5>
            <p class="card-text">{{ contract.start_date }}</p>
          </li>
          <li class="list-group-item">
            <h5 class="card-title">Duration</h5>
            <p class="card-text">{{ contract.job.duration }} days</p>
          </li>
        </ul>
        <div class="card-body">
          <h5 class="card-title">Terms and Conditions</h5>
          <p>Before proceeding, click on the link to read the Terms and Conditions.</p>
          <a href="#" data-toggle="modal" data-target="#termsModal">Terms and Conditions</a>
          <p>Sign in the box below if you agree.</p>
        </div>

        <!-- Modal for Terms and Conditions -->
        <div class="modal fade" id="termsModal" tabindex="-1" role="dialog" aria-labelledby="termsModalLabel" aria-hidden="true">
          <!-- Modal content -->
        </div>

        <div class="card-body form-container">
          <form method="post" id="acceptForm" class="text-center">
            {% csrf_token %}
            <!-- Add a div to hold the signature pad -->
            <div id="signaturePad" class="signature-pad">
              <canvas></canvas>
            </div>

            <!-- Add a hidden input field to store the signature data -->
            <input type="hidden" id="signatureData" name="signature_data">
            <button type="button" class="btn btn-primary" id="clearButton">
              <i class="fas fa-paint-brush"></i> Clear Signature
            </button>
            <div class="btn-group" role="group">
              <button type="submit" name="accept" class="btn btn-success mr-2">Accept</button>
              <button type="submit" name="reject" class="btn btn-danger ml-auto">Reject</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Include the Signature Pad library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var signaturePad = new SignaturePad(document.querySelector('canvas'));

    // Clear the signature pad when the "Clear Signature" button is clicked
    document.getElementById('clearButton').addEventListener('click', function() {
      signaturePad.clear();
    });

    // Submit the signature data when the form is submitted
    document.getElementById('acceptForm').addEventListener('submit', function(event) {
      // Get the signature data as an image URL
      var signatureData = signaturePad.toDataURL();

      // Set the value of the hidden input field to the signature data
      document.getElementById('signatureData').value = signatureData;

      // Check if the signature data is blank before submitting the form
      if (isSignatureBlank(signatureData)) {
        // Signature is blank, prevent form submission
        event.preventDefault();
        alert('Please provide a signature before accepting the contract.s');
      }
    });

    
  });
</script>

{% endblock %}
